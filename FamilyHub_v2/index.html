<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>FamilyHub</title>

    <!-- ==== NEU: "Dynamische" Animation ==== -->
    <style>
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fade-in {
        animation: fadeIn 0.3s ease-out;
      }
    </style>
  </head>
  <body class="bg-primary-bg text-text-main">
    <div
      id="app-loader"
      class="fixed inset-0 flex items-center justify-center bg-primary-bg z-50"
    >
      <div class="spinner"></div>
    </div>

    <!-- NEU: Container nur für Login/Registrierung -->
    <div id="auth-container"></div>

    <div
      id="app-shell"
      class="hidden min-h-screen pb-20 lg:pb-0 lg:grid lg:grid-cols-[280px_1fr]"
    >
      <!-- ... Deine Sidebar (unverändert) ... -->
      <aside
        class="hidden lg:block bg-primary-bg border-r border-border-glass p-6"
      >
        <div class="mb-8">
          <h1 class="text-2xl font-bold text-gradient">FamilyHub</h1>
        </div>
        <nav class="space-y-2">
          <a href="#" class="nav-item-desktop active" data-page="feed">
            <i data-lucide="home"></i> <span>Feed</span>
          </a>
          <a href="#" class="nav-item-desktop" data-page="chat">
            <i data-lucide="message-circle"></i> <span>Chat</span>
          </a>
          <a href="#" class="nav-item-desktop" data-page="calendar">
            <i data-lucide="calendar-days"></i> <span>Kalender</span>
          </a>
          <a href="#" class="nav-item-desktop" data-page="pinnwand">
            <i data-lucide="kanban-square"></i> <span>Pinnwand</span>
          </a>
          <a href="#" class="nav-item-desktop" data-page="wishlist"
            ><i data-lucide="gift"></i><span>Wünsche</span></a
          >

          <a href="#" class="nav-item-desktop" data-page="challenges">
            <i data-lucide="award"></i> <span>Challenges</span>
            <span class="nav-badge-premium">Pro</span>
          </a>

          <a href="#" class="nav-item-desktop" data-page="menu">
            <i data-lucide="layout-grid"></i> <span>Mehr</span>
          </a>
        </nav>
      </aside>

      <!-- ... Dein Hauptbereich (unverändert) ... -->
      <div class="lg:flex lg:flex-col lg:h-screen">
        <header
          class="sticky top-0 z-30 lg:z-auto lg:static glass-premium lg:glass-none lg:bg-transparent border-b border-border-glass lg:border-none p-4 flex items-center gap-3 lg:hidden"
        >
          <i
            id="header-icon"
            data-lucide="home"
            class="w-6 h-6 text-accent-glow"
          ></i>
          <h2 id="header-title" class="text-xl font-bold text-white">Feed</h2>
        </header>

        <main
          id="app-content"
          class="flex-1 p-4 lg:p-8 lg:overflow-y-auto"
        ></main>
      </div>

      <!-- ... Deine Mobile-Navigation (unverändert) ... -->
      <nav id="bottom-nav" class="lg:hidden flex justify-around">
        <button class="nav-item active" data-page="feed">
          <i data-lucide="home"></i> <span>Feed</span>
        </button>
        <button class="nav-item" data-page="calendar">
          <i data-lucide="calendar-days"></i> <span>Kalender</span>
        </button>
        <button class="nav-item" data-page="pinnwand">
          <i data-lucide="kanban-square"></i> <span>Pinnwand</span>
        </button>
        <button class="nav-item" data-page="wishlist">
          <i data-lucide="gift"></i><span>Wünsche</span>
        </button>

        <button class="nav-item" data-page="menu">
          <i data-lucide="layout-grid"></i> <span>Mehr</span>
        </button>
      </nav>

      <!-- Notfallknopf -->
      <button
        id="emergency-button"
        class="emergency-button"
        aria-label="Notfall"
      >
        <i data-lucide="alert-triangle" class="w-6 h-6"></i>
        <div class="emergency-progress"></div>
      </button>
    </div>

    <template id="template-login">
      <div
        class="flex items-center justify-center min-h-[70vh] animate-fade-in"
      >
        <div class="w-full max-w-md">
          <form id="login-form">
            <div class="glass-premium p-6 sm:p-8 rounded-xl">
              <h2 class="text-2xl font-bold text-gradient mb-6 text-center">
                Willkommen zurück
              </h2>

              <div class="space-y-4">
                <div>
                  <label
                    for="login-email"
                    class="form-label text-sm text-secondary mb-1 block"
                    >E-Mail</label
                  >
                  <input
                    type="email"
                    id="login-email"
                    class="form-input"
                    required
                    placeholder="name@familie.de"
                  />
                </div>
                <div>
                  <label
                    for="login-pass"
                    class="form-label text-sm text-secondary mb-1 block"
                    >Passwort</label
                  >
                  <input
                    type="password"
                    id="login-pass"
                    class="form-input"
                    required
                    placeholder="••••••••"
                  />
                </div>
              </div>

              <button type="submit" class="cta-primary-glow w-full mt-6">
                <span class="btn-text">Anmelden</span>
              </button>

              <p class="text-center text-sm text-secondary mt-6">
                Noch kein Konto?
                <button
                  type="button"
                  class="font-semibold text-accent-glow hover:underline"
                  data-auth-toggle="register"
                >
                  Jetzt registrieren
                </button>
              </p>
            </div>
          </form>

          <form id="register-form" class="hidden">
            <div class="glass-premium p-6 sm:p-8 rounded-xl">
              <h2 class="text-2xl font-bold text-gradient mb-6 text-center">
                Konto erstellen
              </h2>

              <div class="space-y-4">
                <div>
                  <label
                    for="register-name"
                    class="form-label text-sm text-secondary mb-1 block"
                    >Dein Name</label
                  >
                  <input
                    type="text"
                    id="register-name"
                    class="form-input"
                    required
                  />
                </div>
                <div>
                  <label
                    for="register-email"
                    class="form-label text-sm text-secondary mb-1 block"
                    >E-Mail</label
                  >
                  <input
                    type="email"
                    id="register-email"
                    class="form-input"
                    required
                  />
                </div>
                <div>
                  <label
                    for="register-pass"
                    class="form-label text-sm text-secondary mb-1 block"
                    >Passwort</label
                  >
                  <input
                    type="password"
                    id="register-pass"
                    class="form-input"
                    required
                  />
                </div>
              </div>

              <button type="submit" class="cta-primary-glow w-full mt-6">
                <span class="btn-text">Konto erstellen</span>
              </button>

              <p class="text-center text-sm text-secondary mt-6">
                Bereits ein Konto?
                <button
                  type="button"
                  class="font-semibold text-accent-glow hover:underline"
                  data-auth-toggle="login"
                >
                  Zurück zum Login
                </button>
              </p>
            </div>
          </form>
        </div>
      </div>
    </template>

    <!-- Template für die Willkommens-Seite (nach Login, ohne Familie) -->
    <template id="template-welcome">
      <!-- Inhalt wird von welcome.js gerendert -->
    </template>

    <!-- ==== ÄNDERUNG HIER: "schlankeres" Layout ==== -->
    <template id="template-feed">
      <!-- Ein zentrierter Container für den gesamten Feed-Inhalt -->
      <div class="max-w-2xl mx-auto">
        <div id="gratitude-trigger-container" class="mb-6"></div>

        <!-- Die Posts kommen hier rein -->
        <div id="feed-posts-container" class="mb-6"></div>

        <!-- Die Widgets kommen darunter -->
        <aside class="w-full">
          <div id="goal-widget-container"></div>
        </aside>
      </div>

      <!-- Der FAB bleibt, wo er war -->
      <button
        id="fab-create-post"
        class="fab-create-post"
        title="Neuer Beitrag"
      >
        <i data-lucide="plus" class="w-7 h-7"></i>
      </button>
    </template>

    <!-- ... Restliche Templates (unverändert) ... -->
    <template id="template-pinnwand">
      <div class="pinnwand-column-container">
        <div class="pinnwand-column" data-status="todo">
          <div class="pinnwand-column-header">
            <h3>Zu erledigen</h3>
            <span class="count" id="count-todo">0</span>
            <button class="btn-add-task" data-status="todo">
              <i data-lucide="plus" class="w-5 h-5"></i>
            </button>
          </div>
          <div class="pinnwand-card-list" id="pinnwand-todo"></div>
        </div>
        <div class="pinnwand-column" data-status="progress">
          <div class="pinnwand-column-header">
            <h3>In Bearbeitung</h3>
            <span class="count" id="count-progress">0</span>
            <button class="btn-add-task" data-status="progress">
              <i data-lucide="plus" class="w-5 h-5"></i>
            </button>
          </div>
          <div class="pinnwand-card-list" id="pinnwand-progress"></div>
        </div>
        <div class="pinnwand-column" data-status="done">
          <div class="pinnwand-column-header">
            <h3>Erledigt</h3>
            <span class="count" id="count-done">0</span>
            <button class="btn-add-task" data-status="done">
              <i data-lucide="plus" class="w-5 h-5"></i>
            </button>
          </div>
          <div class="pinnwand-card-list" id="pinnwand-done"></div>
        </div>
      </div>
    </template>

    <template id="template-community">
      <div class="pinnwand-column-container">
        <div class="pinnwand-column" data-status="todo">
          <div class="pinnwand-column-header">
            <h3>Geplant</h3>
            <span class="count" id="count-todo">0</span>
            <button class="btn-add-task" data-status="todo">
              <i data-lucide="plus" class="w-5 h-5"></i>
            </button>
          </div>
          <div class="pinnwand-card-list" id="pinnwand-todo"></div>
        </div>
        <div class="pinnwand-column" data-status="progress">
          <div class="pinnwand-column-header">
            <h3>Aktiv</h3>
            <span class="count" id="count-progress">0</span>
            <button class="btn-add-task" data-status="progress">
              <i data-lucide="plus" class="w-5 h-5"></i>
            </button>
          </div>
          <div class="pinnwand-card-list" id="pinnwand-progress"></div>
        </div>
        <div class="pinnwand-column" data-status="done">
          <div class="pinnwand-column-header">
            <h3>Abgeschlossen</h3>
            <span class="count" id="count-done">0</span>
            <button class="btn-add-task" data-status="done">
              <i data-lucide="plus" class="w-5 h-5"></i>
            </button>
          </div>
          <div class="pinnwand-card-list" id="pinnwand-done"></div>
        </div>
      </div>
    </template>

    <template id="template-zeitkapsel">
      <div class="flex flex-col gap-6">
        <div class="flex justify-between items-center">
          <h2 class="text-2xl font-bold text-gradient">Zeitkapsel</h2>
          <button id="btn-create-capsule" class="cta-primary-glow">
            <i data-lucide="plus" class="w-5 h-5 mr-2"></i> Neue Kapsel
            erstellen
          </button>
        </div>

        <p class="text-text-secondary text-sm">
          Erstelle Nachrichten und Erinnerungen, die erst in der Zukunft
          sichtbar werden. Perfekt für Geburtstage, Jubiläen oder besondere
          Momente.
        </p>

        <div
          id="zeitkapsel-container"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
        >
          <div class="flex justify-center items-center p-8 col-span-full">
            <div class="spinner"></div>
          </div>
        </div>
      </div>
    </template>

    <template id="template-hobbys">
      <div class="flex flex-col gap-6">
        <div class="flex justify-between items-center">
          <h2 class="text-2xl font-bold text-gradient">Hobbys & Interessen</h2>
          <button id="btn-create-hobby" class="cta-primary-glow">
            <i data-lucide="plus" class="w-5 h-5 mr-2"></i> Neues Hobby
            vorschlagen
          </button>
        </div>

        <p class="text-text-secondary text-sm">
          Entdeckt gemeinsame Interessen und plant Aktivitäten zusammen!
        </p>

        <div
          id="hobbys-list-container"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
        >
          <div class="flex justify-center items-center p-8 col-span-full">
            <div class="spinner"></div>
          </div>
        </div>
      </div>
    </template>

    <template id="template-chat">
      <div
        id="chat-container"
        class="glass-premium rounded-xl h-[70vh] flex overflow-hidden"
      >
        <div
          id="chat-list-panel"
          class="w-full lg:w-1/3 border-r border-border-glass flex flex-col transition-all duration-300"
        >
          <div class="p-4 border-b border-border-glass">
            <div class="flex justify-between items-center">
              <h3 class="text-lg font-semibold text-white">Nachrichten</h3>
              <!-- HIER WURDE "onclick" ENTFERNT -->
              <button id="fab-create-chat" class="btn-icon-ghost">
                <i data-lucide="square-plus" class="w-5 h-5"></i>
              </button>
            </div>
          </div>
          <div
            id="chat-list-container"
            class="flex-1 overflow-y-auto p-2 space-y-1"
          ></div>
        </div>

        <div
          id="chat-window-panel"
          class="absolute lg:relative top-0 left-0 w-full h-full lg:w-2/3 flex flex-col bg-primary-bg lg:bg-transparent transform translate-x-full lg:translate-x-0 transition-transform duration-300 z-10"
        >
          <div
            id="chat-empty-state"
            class="flex-1 flex flex-col items-center justify-center text-center p-4"
          >
            <i
              data-lucide="message-circle"
              class="w-16 h-16 text-secondary opacity-30 mb-4"
            ></i>
            <h4 class="text-lg font-semibold text-white">
              Wähle einen Chat aus
            </h4>
            <p class="text-secondary">oder starte eine neue Konversation.</p>
          </div>

          <div
            id="chat-window-active"
            class="lg:flex lg:flex-1 lg:flex-col hidden"
          >
            <div
              class="p-4 border-b border-border-glass flex items-center gap-3"
            >
              <!-- HIER WURDE "onclick" ENTFERNT -->
              <button id="chat-back-button" class="btn-icon-ghost lg:hidden">
                <i data-lucide="chevron-left" class="w-5 h-5"></i>
              </button>
              <img
                id="chat-header-avatar"
                src=""
                alt="Avatar"
                class="w-10 h-10 rounded-full"
              />
              <div>
                <h5 id="chat-header-name" class="font-semibold text-white"></h5>
                <p id="chat-header-status" class="text-xs text-secondary"></p>
              </div>
            </div>
            <div
              id="chat-messages-container"
              class="flex-1 overflow-y-auto p-4 space-y-4"
            ></div>
            <form id="chat-input-form" class="p-4 border-t border-border-glass">
              <div class="flex items-center gap-2">
                <!-- NEU: Anhang-Button -->
                <div class="relative">
                  <button
                    type="button"
                    id="chat-attachment-btn"
                    class="btn-icon-ghost"
                  >
                    <i data-lucide="paperclip" class="w-5 h-5"></i>
                  </button>
                  <!-- Attachment-Menu (zunächst versteckt) -->
                  <div
                    id="chat-attachment-menu"
                    class="hidden absolute bottom-full left-0 mb-2 glass-premium rounded-xl p-2 shadow-xl min-w-[150px] z-50"
                  >
                    <button
                      type="button"
                      id="chat-gallery-btn"
                      class="flex items-center gap-3 w-full p-3 rounded-lg hover:bg-white/10 transition-all"
                    >
                      <i
                        data-lucide="image"
                        class="w-5 h-5 text-accent-glow"
                      ></i>
                      <span class="text-white">Galerie</span>
                    </button>
                    <button
                      type="button"
                      id="chat-camera-btn"
                      class="flex items-center gap-3 w-full p-3 rounded-lg hover:bg-white/10 transition-all"
                    >
                      <i
                        data-lucide="camera"
                        class="w-5 h-5 text-accent-glow"
                      ></i>
                      <span class="text-white">Kamera</span>
                    </button>
                  </div>
                </div>

                <input
                  type="text"
                  id="chat-message-input"
                  class="form-input flex-1"
                  placeholder="Nachricht schreiben..."
                />

                <!-- NEU: Verstecktes File-Input für Galerie -->
                <input
                  type="file"
                  id="chat-file-input"
                  accept="image/*"
                  class="hidden"
                />

                <!-- Send-Button (nur sichtbar, wenn Text vorhanden) -->
                <button
                  type="submit"
                  id="chat-send-btn"
                  class="btn-premium btn-icon"
                >
                  <i data-lucide="send" class="w-5 h-5"></i>
                </button>

                <!-- NEU: Mikrofon-Button (nur sichtbar, wenn kein Text) -->
                <button
                  type="button"
                  id="chat-mic-btn"
                  class="btn-premium btn-icon hidden"
                >
                  <i data-lucide="mic" class="w-5 h-5"></i>
                </button>
              </div>

              <!-- NEU: Recording-Indikator (zunächst versteckt) -->
              <div
                id="chat-recording-indicator"
                class="hidden mt-3 bg-red-500/20 rounded-lg p-3 border border-red-500/30"
              >
                <div class="flex items-center gap-3">
                  <div
                    class="w-3 h-3 bg-red-500 rounded-full animate-pulse"
                  ></div>
                  <span class="text-white font-semibold"
                    >Aufnahme läuft...</span
                  >
                  <span id="chat-recording-time" class="text-secondary ml-auto"
                    >0:00</span
                  >
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </template>

    <template id="template-challenges">
      <h2 class="text-xl font-bold text-gradient mb-6">Leaderboard</h2>
      <div id="leaderboard-container" class="space-y-2 mb-8"></div>

      <h2 class="text-xl font-bold text-gradient mb-6">Aktive Challenges</h2>
      <div id="challenges-container" class="space-y-4"></div>

      <!-- HIER WURDE "onclick" ENTFERNT -->
      <button
        id="fab-create-challenge"
        class="fab-create-post"
        title="Neue Challenge erstellen"
      >
        <i data-lucide="plus" class="w-7 h-7"></i>
      </button>
    </template>

    <template id="template-settings">
      <div class="settings-layout">
        <nav id="settings-nav" class="settings-nav">
          <button class="settings-nav-item" data-tab="profile">
            <i data-lucide="user"></i>
            <span>Profil</span>
          </button>
          <button class="settings-nav-item" data-tab="family">
            <i data-lucide="users"></i>
            <span>Familie</span>
          </button>
          <button class="settings-nav-item" data-tab="goals">
            <i data-lucide="flag"></i>
            <span>Ziele</span>
          </button>
          <button class="settings-nav-item" data-tab="invite">
            <i data-lucide="send"></i>
            <span>Einladen</span>
          </button>
          <button class="settings-nav-item" data-tab="notifications">
            <i data-lucide="bell"></i>
            <span>Mitteilungen</span>
            <span class="nav-badge-premium">Pro</span>
          </button>
          <button class="settings-nav-item" data-tab="child-controls">
            <i data-lucide="shield"></i>
            <span>Kindersicherung</span>
          </button>
        </nav>

        <div id="settings-tab-content" class="glass-premium p-6 lg:p-8">
          <section id="settings-profile" class="settings-tab-panel">
            <h2 class="text-lg font-bold text-gradient mb-4">Profil</h2>
            <form id="profile-form" class="flex flex-col gap-4 max-w-md">
              <label class="flex flex-col gap-1">
                <span class="text-secondary text-sm">Name</span>
                <input id="profile-name" type="text" class="form-input" />
              </label>
              <label class="flex flex-col gap-1">
                <span class="text-secondary text-sm">E-Mail</span>
                <input
                  id="profile-email"
                  type="email"
                  class="form-input"
                  disabled
                />
              </label>
              <label class="flex flex-col gap-1">
                <span class="text-secondary text-sm">Mein Geburtstag</span>
                <input id="profile-birthday" type="date" class="form-input" />
              </label>
              <button type="submit" class="cta-primary-glow mt-2 self-start">
                <i data-lucide="save" class="w-5 h-5 mr-2"></i> Speichern
              </button>
            </form>
          </section>

          <section id="settings-family" class="settings-tab-panel hidden">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-bold text-gradient">
                Familienmitglieder
              </h2>
              <button id="add-child-profile-btn" class="cta-primary-glow">
                <i data-lucide="plus" class="w-5 h-5 mr-2"></i> Kind-Profil
              </button>
            </div>
            <div id="family-members-list" class="flex flex-col gap-3"></div>
          </section>

          <section id="settings-goals" class="settings-tab-panel hidden">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-bold text-gradient">Familienziele</h2>
              <button id="add-goal-btn" class="cta-primary-glow">
                <i data-lucide="plus" class="w-5 h-5 mr-2"></i> Neues Ziel
              </button>
            </div>
            <div id="goals-list-container" class="space-y-4"></div>
          </section>

          <section id="settings-invite" class="settings-tab-panel hidden">
            <h2 class="text-lg font-bold text-gradient mb-4">
              Familienmitglied einladen
            </h2>
            <form id="invite-form" class="flex flex-col gap-4 max-w-md">
              <label class="flex flex-col gap-1">
                <span class="text-secondary text-sm">E-Mail-Adresse</span>
                <input
                  id="invite-email"
                  type="email"
                  class="form-input"
                  required
                />
              </label>
              <button type="submit" class="cta-primary-glow mt-2 self-start">
                <i data-lucide="send" class="w-5 h-5 mr-2"></i> Einladen
              </button>
            </form>
          </section>

          <section
            id="settings-notifications"
            class="settings-tab-panel hidden"
          >
            <h2 class="text-lg font-bold text-gradient mb-4">
              Mitteilungen (Pro)
            </h2>
            <p class="text-secondary mb-6">
              Steuere, welche Benachrichtigungen du erhalten möchtest. (Diese
              Schalter sind aktuell nur Design-Platzhalter).
            </p>

            <div class="space-y-4 max-w-md">
              <div class="toggle-wrapper">
                <div>
                  <p class="font-medium text-white">Neue Feed-Beiträge</p>
                  <p class="text-sm text-secondary">
                    Wenn ein Mitglied einen neuen Beitrag erstellt.
                  </p>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" checked />
                  <span class="slider"></span>
                </label>
              </div>
              <div class="toggle-wrapper">
                <div>
                  <p class="font-medium text-white">Neue Kommentare</p>
                  <p class="text-sm text-secondary">
                    Wenn jemand deine Beiträge kommentiert.
                  </p>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" checked />
                  <span class="slider"></span>
                </label>
              </div>
              <div class="toggle-wrapper">
                <div>
                  <p class="font-medium text-white">Kalender-Erinnerungen</p>
                  <p class="text-sm text-secondary">
                    Eine Stunde vor einem Termin.
                  </p>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </section>

          <section
            id="settings-child-controls"
            class="settings-tab-panel hidden"
          >
            <h2 class="text-lg font-bold text-gradient mb-4">
              Kindersicherung
            </h2>
            <p class="text-secondary mb-6">
              Verwalte, wer im Namen deiner Kind-Profile posten darf.
            </p>
            <div id="child-controls-container" class="space-y-6">
              <!-- Wird dynamisch gefüllt -->
            </div>
          </section>
        </div>
      </div>
    </template>
    <template id="template-calendar">
      <div class="flex flex-col h-full">
        <div
          id="calendar-header-controls"
          class="flex flex-col md:flex-row gap-4 justify-between items-center mb-6"
        >
          <div class="flex items-center gap-2">
            <button id="calendar-prev" class="icon-button-ghost p-3">
              <i data-lucide="chevron-left" class="w-5 h-5"></i>
            </button>
            <h2
              id="calendar-month-year"
              class="text-xl font-bold text-white text-center w-48"
            >
              <div class="spinner spinner-white mx-auto"></div>
            </h2>
            <button id="calendar-next" class="icon-button-ghost p-3">
              <i data-lucide="chevron-right" class="w-5 h-5"></i>
            </button>
          </div>

          <div id="calendar-view-controls" class="flex items-center gap-2">
            <button class="btn-filter" data-view="day">Tag</button>
            <button class="btn-filter" data-view="week">Woche</button>
            <button class="btn-filter active" data-view="month">Monat</button>
          </div>

          <!-- HIER WURDE "onclick" ENTFERNT -->
          <button
            id="fab-create-event"
            class="cta-primary-glow w-full md:w-auto"
          >
            <i data-lucide="plus" class="w-5 h-5 mr-2"></i> Neuer Termin
          </button>
        </div>

        <div
          id="calendar-body-container"
          class="flex-1 flex flex-col gap-4 glass-premium p-4 lg:p-6 min-h-[60vh]"
        >
          <div id="calendar-grid" class="flex-1 flex flex-col">
            <div
              id="calendar-weekdays"
              class="grid grid-cols-7 gap-2 text-xs text-secondary font-semibold mb-2"
            >
              <div>MO</div>
              <div>DI</div>
              <div>MI</div>
              <div>DO</div>
              <div>FR</div>
              <div>SA</div>
              <div>SO</div>
            </div>
            <div id="calendar-body" class="flex-1 grid grid-rows-5"></div>
          </div>

          <div
            id="agenda-list-container"
            class="hidden lg:flex-1 lg:flex-col lg:overflow-y-auto lg:space-y-3"
          ></div>
        </div>
      </div>
    </template>

    <template id="template-event-detail-modal"> </template>

    <template id="template-gallery">
      <div class="relative min-h-[60vh]">
        <div id="gallery-album-container"></div>

        <div id="gallery-empty-state" class="hidden">
          <div
            class="flex flex-col items-center justify-center h-64 text-center"
          >
            <i
              data-lucide="image-off"
              class="w-12 h-12 mb-4 text-secondary"
            ></i>
            <p class="text-lg text-secondary mb-2">
              Noch keine Medien vorhanden.
            </p>
            <p class="text-sm text-secondary">
              Lade das erste Foto oder Video hoch!
            </p>
          </div>
        </div>

        <div id="gallery-skeleton" class="mt-8"></div>

        <!-- HIER WURDE "onclick" ENTFERNT -->
        <button id="gallery-upload-fab" class="fab-create-post">
          <i data-lucide="plus" class="w-8 h-8"></i>
        </button>
        <!-- HIER WURDE "onchange" ENTFERNT (sollte auch in JS gebunden werden) -->
        <input
          id="gallery-upload-input"
          type="file"
          accept="image/*,video/*"
          multiple
          class="hidden"
        />
      </div>
    </template>

    <template id="template-upload-modal"> </template>

    <template id="template-media-detail-modal"> </template>

    <template id="template-wishlist">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold text-gradient">
          Wunschlisten der Familie
        </h2>
        <!-- HIER WURDE "onclick" ENTFERNT -->
        <button id="fab-create-wish" class="cta-primary-glow">
          <i data-lucide="plus" class="w-5 h-5 mr-2"></i>Neuer Wunsch
        </button>
      </div>

      <div id="wishlist-member-tabs" class="feed-filter-bar mb-6">
        <div class="spinner"></div>
      </div>

      <div
        id="wishlist-grid"
        class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"
      ></div>
      <div id="wishlist-empty-state" class="hidden"></div>
    </template>

    <template id="template-menu">
      <div class="app-dashboard-grid">
        <!-- HIER WURDEN "onclick"s ENTFERNT -->
        <button class="app-dashboard-item" data-page="settings">
          <div class="app-dashboard-icon bg-blue-500/20 text-blue-400">
            <i data-lucide="settings"></i>
          </div>
          <span class="app-dashboard-label">Einstellungen</span>
        </button>
        <button class="app-dashboard-item" data-page="gallery">
          <div class="app-dashboard-icon bg-pink-500/20 text-pink-400">
            <i data-lucide="image"></i>
          </div>
          <span class="app-dashboard-label">Galerie</span>
        </button>
        <button class="app-dashboard-item" data-page="challenges">
          <div class="app-dashboard-icon bg-yellow-500/20 text-yellow-400">
            <i data-lucide="award"></i>
          </div>
          <span class="app-dashboard-label">Challenges</span>
        </button>
        <button class="app-dashboard-item" data-page="finanzen">
          <div class="app-dashboard-icon bg-green-500/20 text-green-400">
            <i data-lucide="piggy-bank"></i>
          </div>
          <span class="app-dashboard-label">Finanzen</span>
        </button>
        <button class="app-dashboard-item" data-page="chronik">
          <div class="app-dashboard-icon bg-purple-500/20 text-purple-400">
            <i data-lucide="history"></i>
          </div>
          <span class="app-dashboard-label">Chronik</span>
          <span class="nav-badge-premium">Pro</span>
        </button>
        <button class="app-dashboard-item" data-page="tickets">
          <div class="app-dashboard-icon bg-orange-500/20 text-orange-400">
            <i data-lucide="ticket"></i>
          </div>
          <span class="app-dashboard-label">Tickets</span>
        </button>
        <button class="app-dashboard-item" data-page="stammbaum">
          <div class="app-dashboard-icon bg-teal-500/20 text-teal-400">
            <i data-lucide="network"></i>
          </div>
          <span class="app-dashboard-label">Stammbaum</span>
        </button>
        <button class="app-dashboard-item" data-page="rezepte">
          <div class="app-dashboard-icon bg-amber-500/20 text-amber-400">
            <i data-lucide="chef-hat"></i>
          </div>
          <span class="app-dashboard-label">Rezepte</span>
        </button>
        <button class="app-dashboard-item" data-page="dokumente">
          <div class="app-dashboard-icon bg-indigo-500/20 text-indigo-400">
            <i data-lucide="file-text"></i>
          </div>
          <span class="app-dashboard-label">Dokumente</span>
        </button>
        <button class="app-dashboard-item" data-page="community">
          <div class="app-dashboard-icon bg-cyan-500/20 text-cyan-400">
            <i data-lucide="building-2"></i>
          </div>
          <span class="app-dashboard-label">Community</span>
        </button>
        <button class="app-dashboard-item" data-page="zeitkapsel">
          <div class="app-dashboard-icon bg-purple-500/20 text-purple-400">
            <i data-lucide="clock"></i>
          </div>
          <span class="app-dashboard-label">Zeitkapsel</span>
        </button>
        <button class="app-dashboard-item" data-page="hobbys">
          <div class="app-dashboard-icon bg-pink-500/20 text-pink-400">
            <i data-lucide="gamepad-2"></i>
          </div>
          <span class="app-dashboard-label">Hobbys</span>
        </button>
      </div>
    </template>

    <template id="template-finanzen">
      <div class="flex flex-col gap-6">
        <!-- Gemeinsamer Topf Header -->
        <div class="glass-premium p-6 rounded-xl">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h2 class="text-2xl font-bold text-gradient mb-1">
                Gemeinsamer Topf
              </h2>
              <p class="text-sm text-text-secondary">Familien-Budget</p>
            </div>
            <i
              data-lucide="piggy-bank"
              class="w-12 h-12 text-primary-rose opacity-50"
            ></i>
          </div>

          <div class="text-center py-6 border-y border-border-glass my-4">
            <p class="text-sm text-text-secondary mb-2">Aktueller Kontostand</p>
            <p
              id="shared-balance-display"
              class="text-5xl font-bold text-gradient"
            >
              <span class="spinner inline-block"></span>
            </p>
          </div>

          <div class="flex gap-3">
            <button id="btn-einzahlen" class="cta-primary-glow flex-1">
              <i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i>
              <span>Einzahlen</span>
            </button>
            <button id="btn-ausbuchen" class="btn-secondary flex-1">
              <i data-lucide="minus-circle" class="w-5 h-5 mr-2"></i>
              <span>Ausbuchen</span>
            </button>
          </div>
        </div>

        <!-- Transaktionsverlauf -->
        <div>
          <h3 class="text-lg font-semibold text-white mb-4">
            Transaktionsverlauf
          </h3>
          <div id="transactions-list-container" class="space-y-3">
            <div class="spinner mx-auto"></div>
          </div>
        </div>

        <!-- Private Ausgaben Sektion (optional, als Ergänzung) -->
        <div>
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-white">Private Ausgaben</h3>
            <button id="btn-private-expense" class="btn-secondary">
              <i data-lucide="receipt" class="w-5 h-5 mr-2"></i>
              <span>Neue Ausgabe</span>
            </button>
          </div>
          <div id="private-expenses-list" class="space-y-3">
            <!-- Private Ausgaben werden hier gerendert -->
          </div>
        </div>
      </div>
    </template>

    <template id="template-chronik"> </template>

    <template id="template-dokumente">
      <div class="flex flex-col gap-6">
        <div class="flex justify-between items-center">
          <h2 class="text-2xl font-bold text-gradient">Dokumente</h2>
          <button id="btn-upload-document" class="cta-primary-glow">
            <i data-lucide="upload" class="w-5 h-5 mr-2"></i> Dokument hochladen
          </button>
        </div>

        <div id="dokumente-list-container" class="space-y-3">
          <div class="flex justify-center items-center p-8">
            <div class="spinner"></div>
          </div>
        </div>
      </div>
    </template>

    <template id="template-tickets">
      <div class="flex flex-col gap-6">
        <div class="flex justify-between items-center">
          <h2 class="text-2xl font-bold text-gradient">Ticket-Planung</h2>
          <button id="btn-create-ticket" class="cta-primary-glow">
            <i data-lucide="plus" class="w-5 h-5 mr-2"></i> Neues Ticket planen
          </button>
        </div>

        <div id="tickets-list-container" class="space-y-4">
          <div class="flex justify-center items-center p-8">
            <div class="spinner"></div>
          </div>
        </div>
      </div>
    </template>

    <template id="template-stammbaum">
      <div class="flex flex-col gap-6">
        <div class="flex justify-between items-center">
          <h2 class="text-2xl font-bold text-gradient">Stammbaum</h2>
        </div>

        <div id="stammbaum-container" class="stammbaum-wrapper">
          <div class="flex justify-center items-center p-8">
            <div class="spinner"></div>
          </div>
        </div>
      </div>
    </template>

    <template id="template-rezepte">
      <div class="flex flex-col gap-6">
        <div class="flex justify-between items-center">
          <h2 class="text-2xl font-bold text-gradient">Familien-Rezepte</h2>
          <button id="btn-create-rezept" class="cta-primary-glow">
            <i data-lucide="plus" class="w-5 h-5 mr-2"></i> Neues Rezept
          </button>
        </div>

        <div
          id="rezepte-grid-container"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"
        >
          <div class="flex justify-center items-center p-8 col-span-full">
            <div class="spinner"></div>
          </div>
        </div>
      </div>
    </template>

    <div id="modal-container"></div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script type="module" src="/src/main.js"></script>
    <script>
      lucide.createIcons();
    </script>
  </body>
</html>
